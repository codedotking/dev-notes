## Kafka 简介

> Apache kafka是消息中间件的一种，我发现很多人不知道消息中间件是什么，在开始学习之前，我这边就先简单的解释一下什么是消息中间件，只是粗略的讲解，目前kafka已经可以做更多的事情。
> 
> 举个例子，生产者消费者，生产者生产鸡蛋，消费者消费鸡蛋，生产者生产一个鸡蛋，消费者就消费一个鸡蛋，假设消费者消费鸡蛋的时候噎住了（系统宕机了），生产者还在生产鸡蛋，那新生产的鸡蛋就丢失了。再比如生产者很强劲（大交易量的情况），生产者1秒钟生产100个鸡蛋，消费者1秒钟只能吃50个鸡蛋，那要不了一会，消费者就吃不消了（消息堵塞，最终导致系统超时），消费者拒绝再吃了，”鸡蛋“又丢失了，这个时候我们放个篮子在它们中间，生产出来的鸡蛋都放到篮子里，消费者去篮子里拿鸡蛋，这样鸡蛋就不会丢失了，都在篮子里，而这个篮子就是”kafka“。鸡蛋其实就是“数据流”，系统之间的交互都是通过“数据流”来传输的（就是tcp、https什么的），也称为报文，也叫“消息”。消息队列满了，其实就是篮子满了，”鸡蛋“ 放不下了，那赶紧多放几个篮子，其实就是kafka的扩容。各位现在知道kafka是干什么的了吧，它就是那个"篮子"。
> 
> 作者：半兽人  
> 链接：https://www.orchome.com/kafka/index  

## Kafka 特性

1. 高吞吐量、低延迟：每秒处理几十万消息，延迟最低只有几毫秒，每个主题可以分区，消费组对分区进行消费。

2. 可扩展性：kafka集群支持热扩展。

3. 持久性、可靠性：信息可以持久化到磁盘，且支持消息备份防止信息丢失。

4. 容错性：允许集群中节点失败（若副本数为n,可以允许n-1个节点失败）。

5. 高并发：支持数千个客户端同时读写。

## Kafka 可以做什么

1. 存储系统（日志收集、用户行为、运营指标）

2. 消息系统

3. 流式处理平台

## Kafka 相关概念

1. **Broker**：已发布的消息保存在一组服务器中，称之为Kafka集群。集群中的每一个服务器都是一个代理（Broker）。 消费者可以订阅一个或多个主题（topic），并从Broker拉数据，从而消费这些已发布的消息。

2. **Topic**：Kafka将消息分门别类，每一类的消息称之为一个主题。

3. **Producer**：发布消息的对象称之为主题生产者。

4. **Consumer**：订阅消息并处理发布的消息的对象称之为主题消费者。

5. **Consumer Group （CG）**： 消费者组，由多个 consumer 组成。 消费者组内每个消费者负责消费不同分区的数据，一个分区只能由一个组内消费者消费；消费者组之间互不影响。 所有的消费者都属于某个消费者组，即消费者组是逻辑上的一个订阅者。

6. **Partition**： 为了实现扩展性，一个非常大的 topic 可以分布到多个 broker（即服务器）上，一个 topic 可以分为多个 partition，每个 partition 是一个有序的队列。

7. **Replica**： 副本（Replication），为保证集群中的某个节点发生故障时， 该节点上的 partition 数据不丢失，且 Kafka 仍然能够继续工作， Kafka 提供了副本机制，一个 topic 的每个分区都有若干个副本，一个 leader 和若干个 follower。

8. **Leader**： 每个分区多个副本的 “主”，生产者发送数据的对象，以及消费者消费数据的对象都是 leader。

9. **Follower**： 每个分区多个副本中的 “从”，实时从 leader 中同步数据，保持和 leader 数据的同步。 leader 发生故障时，某个 Follower 会成为新的 leader。

10. **消费模型**：
    
    1）**点对点模式**：一对一，消费者主动拉取数据，消息收到后消息清除。消息生产者生产消息发送到 Queue 中，然后消息消费者从 Queue 中取出并且消费消息。消息被消费以后， queue 中不再有存储，所以消息消费者不可能消费到已经被消费的消息。Queue 支持存在多个消费者，但是对一个消息而言，只会有一个消费者可以消费。
    
    2）**发布/订阅模式**：一对多，消费者消费数据之后不会清除消息，消息生产者（发布）将消息发布到 topic 中，同时有多个消息消费者（订阅）消费该消息。和点对点方式不同，发布到 topic 的消息会被所有订阅者消费。
